/**
  ******************************************************************************
  * File Name          : brailleascii.c
  * Description        : Braille <-> ASCII conversion 
	* version            : 1.0	
	* Date               : 3 Aug 2016
  ******************************************************************************
  */
/* Includes ------------------------------------------------------------------*/
#include "brailleascii.h"
#include "ff.h"

//----------------------------------------------------------------------------------------------------------//

const banatable_s table[TABLE_MAX_ENTRIES]=
{ 
	//ASCII   keycodes  brailledots
	{ 	0x0A,		0xCF,		0xCF	},//P // New paragraph & new line indicator
	{ 	0x0D,		0xEB,   0xEB	},//$     // New paragraph & new line indicator
	{ 	0x20,  	0x00, 	0x00	},//space
	{ 	0x21, 	0x2E, 	0x2E	},//!
	{ 	0x22, 	0x10, 	0x10	},//"
	{ 	0x23, 	0x3C, 	0x3C	},//#
	{ 	0x24, 	0x2B, 	0x2B	},//$
	{ 	0x25, 	0x29, 	0x29	},//%
	{ 	0x26, 	0x2F, 	0x2F	},//&
	{ 	0x27, 	0x04, 	0x04	},//' 
	{ 	0x28, 	0x37, 	0x37	},//(
	{ 	0x29, 	0x3E, 	0x3E	},//)
	{ 	0x2A, 	0x21, 	0x21	},//*
	{ 	0x2B, 	0x2C, 	0x2C	},//+
	{ 	0x2C, 	0x20, 	0x20	},//,
	{ 	0x2D, 	0x24, 	0x24	},//-
	{ 	0x2E, 	0x28, 	0x28	},//.
	{ 	0x2F, 	0x0C, 	0x0C	},///
	{ 	0x30, 	0x34, 	0x34	},//0
	{ 	0x31, 	0x02, 	0x02	},//1
	{ 	0x32, 	0x06, 	0x06	},//2
	{ 	0x33, 	0x12, 	0x12	},//3
	{ 	0x34, 	0x32, 	0x32	},//4
	{ 	0x35, 	0x22, 	0x22	},//5
	{ 	0x36, 	0x16, 	0x16	},//6
	{ 	0x37, 	0x36, 	0x36	},//7
	{ 	0x38, 	0x26, 	0x26	},//8
	{ 	0x39, 	0x14, 	0x14	},//9
	{ 	0x3A, 	0x31, 	0x31	},//:
	{ 	0x3B, 	0x30, 	0x30	},//;
	{ 	0x3C, 	0x23, 	0x23	},//<
	{ 	0x3D, 	0x3F, 	0x3F	},//=
	{ 	0x3E, 	0x1C, 	0x1C	},//>
	{ 	0x3F, 	0x39, 	0x39	},//?
	{ 	0x40, 	0x08, 	0x08	},//@
	{ 	0x41, 	0x01, 	0x01	},//A
	{ 	0x42, 	0x03, 	0x03	},//B
	{ 	0x43, 	0x09, 	0x09	},//C
	{ 	0x44, 	0x19, 	0x19	},//D
	{ 	0x45, 	0x11, 	0x11	},//E
	{ 	0x46, 	0x0B, 	0x0B	},//F
	{ 	0x47, 	0x1B, 	0x1B	},//G
	{ 	0x48, 	0x13, 	0x13	},//H
	{ 	0x49, 	0x0A, 	0x0A	},//I
	{ 	0x4A, 	0x1A, 	0x1A	},//J
	{ 	0x4B, 	0x05, 	0x05	},//K
	{ 	0x4C, 	0x07, 	0x07	},//L
	{ 	0x4D, 	0x0D, 	0x0D	},//M
	{ 	0x4E, 	0x1D, 	0x1D	},//N
	{ 	0x4F, 	0x15, 	0x15	},//O
	{ 	0x50, 	0x0F, 	0x0F	},//P
	{ 	0x51, 	0x1F, 	0x1F	},//Q
	{ 	0x52, 	0x17, 	0x17	},//R
	{ 	0x53, 	0x0E, 	0x0E	},//S
	{ 	0x54, 	0x1E, 	0x1E	},//T
	{ 	0x55, 	0x25, 	0x25	},//U
	{ 	0x56, 	0x27, 	0x27	},//V
	{ 	0x57, 	0x3A, 	0x3A	},//W
	{ 	0x58, 	0x2D, 	0x2D	},//X
	{ 	0x59, 	0x3D, 	0x3D	},//Y
	{ 	0x5A, 	0x35, 	0x35	},//Z
	{ 	0x5B, 	0x2A, 	0x2A	},//[
	{ 	0x5C, 	0x33,		0x33	},//\//
	{ 	0x5D, 	0x3B, 	0x3B	},//]
	{ 	0x5E, 	0x18, 	0x18	},//^
	{ 	0x5F, 	0x38, 	0x38	},//_
	{ 	0x60,		0x08, 	0x08	},//`
	{ 	0x61,		0x01, 	0x01	},//a
	{ 	0x62,		0x03, 	0x03	},//b
	{ 	0x63,		0x09, 	0x09	},//c
	{ 	0x64,		0x19, 	0x19	},//d
	{ 	0x65,		0x11, 	0x11	},//e
	{ 	0x66,		0x0B, 	0x0B	},//f
	{ 	0x67,		0x1B, 	0x1B	},//g
	{ 	0x68,		0x13, 	0x13	},//h
	{ 	0x69,		0x0A, 	0x0A	},//i
	{ 	0x6A,		0x1A, 	0x1A	},//j
	{ 	0x6B,		0x05, 	0x05	},//k
	{ 	0x6C,		0x07, 	0x07	},//l
	{ 	0x6D,		0x0D, 	0x0D	},//m
	{ 	0x6E,		0x1D, 	0x1D	},//n
	{ 	0x6F,		0x15, 	0x15	},//o
	{ 	0x70,		0x0F, 	0x0F	},//p
	{ 	0x71,		0x1F, 	0x1F	},//q
	{ 	0x72,		0x17, 	0x17	},//r
	{ 	0x73,		0x0E, 	0x0E	},//s
	{ 	0x74,		0x1E, 	0x1E	},//t
	{ 	0x75,		0x25, 	0x25	},//u
	{ 	0x76,		0x27, 	0x27	},//v
	{ 	0x77,		0x3A, 	0x3A	},//w
	{ 	0x78,		0x2D, 	0x2D	},//x
	{ 	0x79,		0x3D, 	0x3D	},//y
	{ 	0x7A,		0x35, 	0x35	},//z
	{ 	0x7B,		0x2A,		0x2A	},//{
	{ 	0x7C, 	0x33,		0x33	},//|
	{ 	0x7D, 	0x3B,		0x3B	},//}
	{ 	0x7E, 	0x18,		0x18	},//~
	//---------------------------//
	{ 	0xC0, 	0xAE,		0xAE	},//!
	{ 	0xC1, 	0x90,		0x90	},//"
	{ 	0xC2, 	0xBC,		0xBC	},//#
	{ 	0xC3, 	0xAB,		0xAB	},//$
	{ 	0xC4, 	0xA9,		0xA9	},//%
	{ 	0xC5, 	0xAF,		0xAF	},//&
	{ 	0xC6, 	0x84,		0x84	},//' 
	{ 	0xC7, 	0xB7,		0xB7	},//(
	{ 	0xC8, 	0xBE,		0xBE	},//)
	{ 	0xC9, 	0xA1,		0xA1	},//*
	{ 	0xCA, 	0xAC,		0xAC	},//+
	{ 	0xCB, 	0xA0,		0xA0	},//,
	{ 	0xCC, 	0xA4,		0xA4	},//-
	{ 	0xCD, 	0xA8,		0xA8	},//.
	{ 	0xCE, 	0x8C,		0x8C	},///
	{ 	0xCF, 	0xB4,		0xB4	},//0
	{ 	0xD0, 	0x82,		0x82	},//1
	{ 	0xD1, 	0x86,		0x86	},//2
	{ 	0xD2, 	0x92,		0x92	},//3
	{ 	0xD3, 	0xB2,		0xB2	},//4
	{ 	0xD4, 	0xA2,		0xA2	},//5
	{ 	0xD5, 	0x96,		0x96	},//6
	{ 	0xD6, 	0xB6,		0xB6	},//7
	{ 	0xD7, 	0xA6,		0xA6	},//8
	{ 	0xD8, 	0x94,		0x94	},//9
	{ 	0xD9, 	0xB1,		0xB1	},//:
	{ 	0xDA, 	0xB0,		0xB0	},//;
	{ 	0xDB, 	0xA3,		0xA3	},//<
	{ 	0xDC, 	0xBF,		0xBF	},//=
	{ 	0xDD, 	0x9C,		0x9C	},//>
	{ 	0xDE, 	0xB9,		0xB9	},//?
	{ 	0xDF, 	0x88,		0x88	},//@
	{ 	0xE0, 	0x81,		0x81	},//A
	{ 	0xE1, 	0x83,		0x83	},//B
	{ 	0xE2, 	0x89,		0x89	},//C
	{ 	0xE3, 	0x99,		0x99	},//D
	{ 	0xE4, 	0x91,		0x91	},//E
	{ 	0xE5, 	0x8B,		0x8B	},//F
	{ 	0xE6, 	0x9B,		0x9B	},//G
	{ 	0xE7, 	0x93,		0x93	},//H
	{ 	0xE8, 	0x8A,		0x8A	},//I
	{ 	0xE9, 	0x9A,		0x9A	},//J
	{ 	0xEA, 	0x85,		0x85	},//K
	{ 	0xEB, 	0x87,		0x87	},//L
	{ 	0xEC, 	0x8D,		0x8D	},//M
	{ 	0xED, 	0x9D,		0x9D	},//N
	{ 	0xEE, 	0x95,		0x95	},//O
	{ 	0xEF, 	0x8F,		0x8F	},//P
	{ 	0xF0, 	0x9F,		0x9F	},//Q
	{ 	0xF1, 	0x97,		0x97	},//R
	{ 	0xF2, 	0x8E,		0x8E	},//S
	{ 	0xF3, 	0x9E,		0x9E	},//T
	{ 	0xF4, 	0xA5,		0xA5	},//U
	{ 	0xF5, 	0xA7,		0xA7	},//V
	{ 	0xF6, 	0xBA,		0xBA	},//W
	{ 	0xF7, 	0xAD,		0xAD	},//X
	{ 	0xF8, 	0xBD,		0xBD	},//Y
	{ 	0xF9, 	0xB5,		0xB5	},//Z
	{ 	0xFA, 	0xAA,		0xAA	},//[
	{ 	0xFB, 	0xB3,		0xB3	},//\//
	{ 	0xFC, 	0xBB,		0xBB	},//]
	{ 	0xFD, 	0x98,		0x98	},//^
	{ 	0xFE, 	0xB8,		0xB8	},//_
};

//------------------------------------//FOR EDITOR ONLY-----------------------------------------------

uint8_t ConvertKeycodesToBanaCodes(uint8_t param){
		uint8_t count = 0;
		bool MatchFound_Flag = FALSE;	
		
		for (count=0; count < TABLE_MAX_ENTRIES; count++)
		{
				if(table[count].keycodes == param)
				{
						MatchFound_Flag = TRUE;		
						break; 
				}
		}//end of for loop
		if(MatchFound_Flag)
		{
				return table[count].BanaCode;
		}
		else
		{
				return ((uint8_t)0x20);
		}
}//end of ConvertKeycodesToBanaCodes()


uint8_t ConvertBanaCodesToBraillePattern(uint8_t param){
		uint8_t count;
		bool MatchFound_Flag = FALSE;		

		for (count=0; count < TABLE_MAX_ENTRIES; count++)
		{
				if(table[count].BanaCode == param)
				{
						MatchFound_Flag = TRUE;
						break; 
				}
		}
		if(MatchFound_Flag)
		{
				return table[count].brailledots;
		}
		else
		{
				return 0x00;
		}
}//end of ConvertBanaCodesToBraillePattern()

uint8_t bana_codes_to_braille_pattern(uint8_t *ptr_bana_buff, uint8_t *ptr_braille_buff, uint16_t bana_buff_cnt, uint16_t *braille_count)
{
	  uint16_t buff_cnt;

    *braille_count = 0;
	  for(buff_cnt = 0; buff_cnt < bana_buff_cnt; buff_cnt++)
	  {
				// If found the end of string character
				if('\0' == *(ptr_bana_buff+buff_cnt))
				{
					break;
				}
				*(ptr_braille_buff+buff_cnt) = ConvertBanaCodesToBraillePattern(*(ptr_bana_buff+buff_cnt));
				*braille_count+=1;
	  }
		return 0;
}


uint8_t ConvertBraillePatternToBanaCodes(uint8_t braille_pattern)
{
		uint16_t count = 0;
	  uint8_t matchfound_flag = FALSE;
	  
	  if(braille_pattern == 0x00)
		{
				return ((TCHAR)0x20);
		}
		else
		{
				for(count=0; count < TABLE_MAX_ENTRIES; count++)
				{
						if(table[count].brailledots == braille_pattern)
						{
								matchfound_flag = TRUE;		
								break; 
						}
				}
			 
				if(matchfound_flag)
				{
						return table[count].BanaCode;
				}
				else
				{
						return ((TCHAR)0x20);
				}
		}
}//end of ConvertBraillePatternToBanaCodes()

void braille_pattern_to_bana(uint8_t const *ptr_braille_buff, uint8_t *ptr_bana_buff, uint16_t ueb_buff_cnt, uint16_t *bana_count)
{
	  uint16_t buff_cnt;
	  *bana_count = 0;
	  for(buff_cnt = 0; buff_cnt < ueb_buff_cnt; buff_cnt++)
	  {
				// If found the end of file indicator = 0xFF
				if(0xFF == *ptr_braille_buff)									  break;
			
				// If found UTF-8 indicator &  CR, LF, TAB(Horizontal)
				if((0x7B == *ptr_braille_buff)||(0x7D == *ptr_braille_buff)||(0x7C == *ptr_braille_buff))
				{
						*(ptr_bana_buff+buff_cnt) = *ptr_braille_buff;
						*bana_count+=1;
				}
				else
				{
						*(ptr_bana_buff+buff_cnt) = ConvertBraillePatternToBanaCodes(*ptr_braille_buff);
						*bana_count+=1;
				}
				ptr_braille_buff++;
		}
}

